# EC2 の概要

## EC2 とは

### 数分で利用可能となる従量課金(時間~秒単位)で利用可能な仮想サーバー

- 起動・ノード追加・削除・マシンスペック変更が数分で可能
- 汎用的な Intel アーキテクチャを採用
- 管理者権限で利用可能
- Windows や Linux などのほとんどの OS をサポート
- OS までは提供さているタイプを選択することで自動設定され、OS より上のレイヤーをカスタマイズできる
- 独自の Amazon Machine Image に OS 設定を作成し、保存して再利用が可能

### 利用する単位をインスタンスと呼び、任意の AZ にインスタンスを立ち上げて、サーバーとして利用する

## AMI イメージ

### AMI イメージは OS セッティング方式を選択すること

AMI：インスタンス起動用の OS イメージ、S3 に保存されている。

- AWS 提供
- 3rdParty
- カスタム

## インスタンスタイプ

### インスタンスタイプの選択は CPU・メモリ、ストレージ、ネットワークキャパシティなどのサーバーリソースの選択

t2.nano

t=ファミリー
2=世代
nano=インスタンスの容量

## インスタンスファミリー

- M5：汎用
- T2：汎用
- C5:コンピューティング最適化
- H1：ストレージ最適化
- D2：ストレージ最適化
- R4：メモリ最適化
- X1：メモリ最適化
- F1:FPGA
- G3:GPU

## リザーブドインスタンス

### 利用期間を長期指定して利用する方式で、オンデマンドに比較して最大 75％割安になる。

![image](https://user-images.githubusercontent.com/42207426/98784307-4474a700-243e-11eb-8f81-97265e8fe265.png)

## スポットインスタンス

### 予備のコンピューティング容量を、オンデマンドインスタンスに比べて割引(最大 90%引き)で利用できる EC2 インスタンス

- 予備用を入札式で利用するためとても安い(最大 90％引き)
- 起動に通常よりも少し時間がかかる
- 予備用のため途中で削除される可能性がある

  ⇒ 一時的な拡張(オートスケール)などの用途で利用

## Saving Plan

### 1~3 年の期間に一定の使用量を守ることにより、Amazon EC2 コストを削減する

- リザーブドインスタンスと同様に、1 年または 3 年の期間に特定の量の処理能力(USD/時間)を使用する契約を結ぶことで適用される割引契約
- AWS コンピューティング使用料金を最大 72％節約できる
- Amazon EC2,AWS Fargate,AWS Lambda に適用可能

## 物理対応可能なインスタンス

### 物理サーバーにインスタンスを起動して制御可能なタイプのインスタンス

【ハードウェア専有インスタンス】

- 専用 HW の VPC で実行される EC2 インスタンス
- ホスト HW のレベルで、他の AWS アカウントに属するインスタンスから物理的に分離する
- 同じ AWS アカウントのインスタンスとは HW を共有する可能性がある

【Dedicated Host】

- EC2 インスタンス容量を完全にお客様専用として利用できる物理サーバー
- サーバーにバインドされた既存のソフトウェアライセンスを利用可能

【Bare Metal】

- アプリケーションが基盤とるサーバーのプロセッサーとメモリに直接アクセス可能なインスタンス
- AWS の各種サービスとの連携が可能で OS が直接下層のハードウェアにアクセス可能

## ストレージ

### EC2 で直接利用するストレージは不可分なインスタンスストアと自分で設定する EBS の 2 つ

【インスタンスストア】

- ホストコンピュータに内蔵されたディスクで EC2 と不可分のブロックレベルの物理ストレージ
- EC2 の一時的なデータが保持され、EC2 の停止・終了と共にクリアされる
- 無料

【Elastic Block Store(EBS)】

- ネットワークで接続されたブロックレベルのストレージで EC2 とは独立して管理される
- EC2 を Terminate しても EBS は保持可能で、Snapshot を S3 に保持可能
- 別途 EBS 料金が必要

## セキュリティグループ

### インスタンスへのトラフィックのアクセス可否を設定するファイアーウォール機能を提供

- デフォルトは SSh(22)のみ
- HTTP(8080)は許可されていないため、Web サーバーを立てる場合は、許可する必要がある

## キーペア

### キーペアを利用して自身がダウンロードした秘密鍵とマッチした公開鍵を有するインスタンスにアクセスする

## EC2 のバックアップ

### EC2 インスタンスは定期的にバックアップすることが重要

- 定期的にバックアップをとる
- 定期的にリカバリプロセスを確認する
- 複数の AZ に重要なアプリケーションをデプロイすること
- フェイルオーバー対応を準備すること
- イベントをモニタリングして対応できるようにすること
- インスタンス起動時に動的 IP アドレス処理の設定を行うこと
